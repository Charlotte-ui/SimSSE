<app-header [scenario]="scenario" ></app-header>
<mat-tab-group>
  <mat-tab label="Infos générales">
    <app-general-infos [scenario]="scenario" (newTotalPlastron)="totalPlastron = $event"></app-general-infos>
  </mat-tab>
  <mat-tab label="Groupes">
    <app-groupes *ngIf="groupes" [groupes]="groupes" [scenario]="scenario"></app-groupes>
  </mat-tab>
  <mat-tab label="Plastrons et modèles">
    <!-- Plastrons  -->
    <div class="container">
      <div class="row" cdkDropListGroup>
        <div class="col-7 plastron">

          <mat-card>
            <mat-card-header>
              <div class="container">
                <mat-card-title>Plastrons</mat-card-title>
              </div>
            </mat-card-header>

            <mat-form-field>
              <mat-label>Filtre</mat-label>
              <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Mia" #input>
            </mat-form-field>
            

            <table mat-table  #table
            *ngIf="dataSourcePlastron"
            [dataSource]="sortedDataSourcePlastron"
            multiTemplateDataRows
            cdkDropList
            (cdkDropListDropped)="drop($event)"
            cdkDropListData="dataSourcePlastron"
            cdkDropListDisabled="true"
            matSort 
            (matSortChange)="sortData($event)">

              <!-- id Column -->
              <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by id">N°</th>
                <td mat-cell *matCellDef="let element">
                  {{element.numero}}
                </td>
              </ng-container>


              <!-- Modele Column -->
              <ng-container matColumnDef="modele">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Modèle</th>
                <td mat-cell *matCellDef="let element">
                  <button mat-button (click)="goToPlastron(element.id)">{{element.modele}}</button>
                </td>
              </ng-container>

              <!-- Triage Column -->
              <ng-container matColumnDef="triage">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Triage</th>
                <td mat-cell *matCellDef="let element">
                  <app-triage [triage]="element.triage" ></app-triage>
                </td>
              </ng-container>

              <!-- Group Column -->
              <ng-container matColumnDef="groupe">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Groupe</th>
                <td mat-cell *matCellDef="let element">
                  <mat-form-field appearance="fill">
                    <mat-label>Groupe</mat-label>
                    <mat-select [(value)]="element.groupe">
                      <mat-option *ngFor="let groupe of groupes" [value]="groupe.scene">
                        {{groupe.scene}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Statut Column -->
              <ng-container matColumnDef="statut">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Statut</th>
                <td mat-cell *matCellDef="let element">
                  <mat-form-field appearance="fill">
                    <mat-label>Statut</mat-label>
                    <mat-select [(value)]="element.statut">
                      <mat-option value="En cours">En cours</mat-option>
                      <mat-option value="A faire">A faire</mat-option>
                      <mat-option value="Terminé">Terminé</mat-option>

                    </mat-select>
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Description Column -->
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef >Description</th>
                <td mat-cell *matCellDef="let element" >
                  <button mat-icon-button aria-label="expand row" (click) = "(expandedElement = expandedElement === element ? null : element) ; $event.stopPropagation()">
                    <mat-icon *ngIf="expandedElement !== element">keyboard_arrow_down</mat-icon>
                    <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
                  </button>
                </td>
              </ng-container>

              <!-- expanded Description Column -->
              <ng-container matColumnDef="expandedDescription">
                <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumnsPlastron.length">
                  <div class="expanded row" [@descriptionExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                    <div class="col-3 profil">
                      <div class="age"> Âge : {{element.age}} </div>
                      <div class="sexe"> Sexe : {{element.sexe?'Femme':'Homme'}} </div>
                    </div>
                    <div class="col-9 description">
                      {{element.description}}
                    </div>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsPlastron"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsPlastron;"
              cdkDrag
              [cdkDragData]="row"
              [class.expandedDescription]="expandedElement === row"
              (click)="expandedElement = expandedElement === row ? null : row"
              class="box">
              </tr>
              <tr mat-row *matRowDef="let row; columns: ['expandedDescription']" class="description-row"></tr>
            </table>
          </mat-card>
        </div>

        <div class="col-5 modele">
          <app-list-box titre="Modèles" type="Modele" ></app-list-box>
        </div>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>